/*
 * Allwinner Technology CO., Ltd.
 */

/dts-v1/;

#include "sun55i-t527.dtsi"
#include "sun55i-t527-walnutpi-2b-audio.dtsi"
#include "sun55i-t527-walnutpi-2b-ir.dtsi"
#include "sun55i-t527-walnutpi-2b-uart.dtsi"
#include "sun55i-t527-walnutpi-2b-twi.dtsi"
#include "sun55i-t527-walnutpi-2b-spi.dtsi"
#include "sun55i-t527-walnutpi-2b-pwm.dtsi"
#include "sun55i-t527-walnutpi-2b-gmac.dtsi"
#include "sun55i-t527-walnutpi-2b-video.dtsi"
#include "sun55i-t527-walnutpi-2b-disp.dtsi"
#include <dt-bindings/leds/common.h>
/{
	model = "walnutpi-2b";
	board = "T527";
	compatible = "allwinner,t527", "arm,sun55iw3p1";

	aliases {
		pmu0 = &pmu0;
		serial0 = &uart0;
		hdmi = &hdmi;
		reg-axp1530 = &reg_ext_axp1530_dcdc1;
		axp1530 = &axp1530;
		cpu-ext = &cpu4;
		standby-param = &standby_param;
		arisc-config = &arisc_config;
		cir_param = &cir_param;
		spi1 = &spi1;
		spi3 = &r_spi0;
	};

	reg_usb0_vbus: usb0-vbus {
		compatible = "regulator-fixed";
		regulator-name = "usb0-vbus";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		regulator-enable-ramp-delay = <1000>;
		// gpio = <&pio PI 12 GPIO_ACTIVE_HIGH>;
		enable-active-high;
	};

	standby_param: standby_param {
		vdd-cpu = <0x00000001>;
		vdd-cpub = <0x00000001>;
		vdd-sys = <0x00000002>;
		vcc-pll = <0x00000080>;
		vcc-io  = <0x00004000>;

		osc24m-on = <0x0>;
	};

	arisc_config: arisc_config {
		s_uart_config {
			pins = "PL2", "PL3";
			function = <2>, <2>;
			status = "disabled";
		};
	};

	reserved-memory {
		dsp0ddr_reserved: dsp0ddr@4a000000 {
			reg = <0x0 0x4a000000 0x0 0x00a00000>;
			no-map;
		};

		riscvsram0_reserved: riscvsram0@7280000 {
			reg = <0x0 0x07280000 0x0 0x40000>;
			no-map;
		};

		riscvsram1_reserved: riscvsram1@72c0000 {
			reg = <0x0 0x072c0000 0x0 0x40000>;
			no-map;
		};

		/*
		* The name should be "vdev%dbuffer".
		* Its size should be not less than
		*     RPMSG_BUF_SIZE * (num of buffers in a vring) * 2
		*   = 512 * (num of buffers in a vring) * 2
		*/
		dsp_vdev0buffer: vdev0buffer@4ac00000 {
			compatible = "shared-dma-pool";
			reg = <0x0 0x4ac00000 0x0 0x40000>;
			no-map;
		};

		/*
		* The name should be "vdev%dvring%d".
		* The size of each should be not less than
		*     PAGE_ALIGN(vring_size(num, align))
		*   = PAGE_ALIGN(16 * num + 6 + 2 * num + (pads for align) + 6 + 8 * num)
		*
		* (Please refer to the vring layout in include/uapi/linux/virtio_ring.h)
		*/
		dsp_vdev0vring0: vdev0vring0@4ac40000 {
			reg = <0x0 0x4ac40000 0x0 0x2000>;
			no-map;
		};
		dsp_vdev0vring1: vdev0vring1@4ac42000 {
			reg = <0x0 0x4ac42000 0x0 0x2000>;
			no-map;
		};

		/*
		 * The name should be "vdev%dbuffer".
		 * Its size should be not less than
		 *     RPMSG_BUF_SIZE * (num of buffers in a vring) * 2
		 *   = 512 * (num of buffers in a vring) * 2
		 */
		rv_vdev0buffer: vdev0buffer@4ae00000 {
			compatible = "shared-dma-pool";
			reg = <0x0 0x4ae00000 0x0 0x40000>;
			no-map;
		};

		/*
		 * The name should be "vdev%dvring%d".
		 * The size of each should be not less than
		 *     PAGE_ALIGN(vring_size(num, align))
		 *   = PAGE_ALIGN(16 * num + 6 + 2 * num + (pads for align) + 6 + 8 * num)
		 *
		 * (Please refer to the vring layout in include/uapi/linux/virtio_ring.h)
		 */
		rv_vdev0vring0: vdev0vring0@4ae40000 {
			reg = <0x0 0x4ae40000 0x0 0x2000>;
			no-map;
		};
		rv_vdev0vring1: vdev0vring1@4ae42000 {
			reg = <0x0 0x4ae42000 0x0 0x2000>;
			no-map;
		};

		/*
		* mcu ram addr
		*/
		mcu0iram_reserved: mcu0iram@20000 {
			reg = <0x0 0x20000 0x0 0x10000>;
			no-map;
		};
		mcu0dram0_reserved: mcu0dram0@30000 {
			reg = <0x0 0x30000 0x0 0x8000>;
			no-map;
		};
		mcu0dram1_reserved: mcu0dram1@38000 {
			reg = <0x0 0x38000 0x0 0x8000>;
			no-map;
		};

		dsp0_rpbuf_reserved: dsp0_rpbuf@4ae44000 {
			compatible = "shared-dma-pool";
			no-map;
			reg = <0x0 0x4ae44000 0x0 0x8000>;
		};

		dsp_share_space@4ab00000 {
			no-map;
			reg = <0x0 0x4ab00000 0x0 0x10000>;
		};
	};

	rpbuf_controller0: rpbuf_controller@0 {
		compatible = "allwinner,rpbuf-controller";
		remoteproc = <&dsp0_rproc>;
		ctrl_id = <0>;
		memory-region = <&dsp0_rpbuf_reserved>;
		status = "okay";
	};

};


&pio {
	vcc-pg-supply = <&reg_pio1_8>;
	vcc-pf-supply = <&reg_pio1_8>;
	vcc-pfo-supply = <&reg_pio3_3>;
	vcc-pd-supply = <&reg_dcdc4>;
	vcc-pe-supply = <&reg_pio1_8>;
	vcc-pi-supply = <&reg_dcdc4>;
	vcc-pj-supply = <&reg_dcdc4>;
	vcc-pk-supply = <&reg_dcdc4>;


	ledc_pins_a: ledc@0 {
		pins = "PH19";
		function = "ledc";
		drive-strength = <10>;
	};

	ledc_pins_b: ledc@1 {
		pins = "PH19";
		function = "gpio_in";
	};


	owa_pins_a: owa@0 {
		pins = "PI10";
		function = "owa";
		drive-strength = <20>;
		bias-disable;
	};

	owa_pins_b: owa@1 {
		pins = "PI10";
		function = "io_disabled";
		drive-strength = <20>;
		bias-disable;
	};


	rgb24_pins_a: rgb24@0 {
		pins = "PD0", "PD1", "PD2", "PD3", "PD4", "PD5", "PD6", "PD7", "PD8", "PD9", \
			"PD10", "PD11", "PD12", "PD13", "PD14", "PD15", "PD16", "PD17", "PD18", "PD19", \
			"PD20", "PD21", "PD22","PD23","PD24","PD25","PD26","PD27";
		      function = "dpss";
		      drive-strength = <30>;
	};

	rgb24_pins_b: rgb24@1 {
		pins = "PD0", "PD1", "PD2", "PD3", "PD4", "PD5", "PD6", "PD7", "PD8", "PD9", \
			"PD10", "PD11", "PD12", "PD13", "PD14", "PD15", "PD16", "PD17", "PD18", "PD19", \
			"PD20", "PD21", "PD22", "PD23","PD24","PD25","PD26","PD27";
		      function = "gpio_in";
	};

	lvds0_pins_a: lvds0@0 {
		pins = "PD0", "PD1", "PD2", "PD3", "PD4", "PD5", "PD6", "PD7", "PD8", "PD9";
		      function = "lvds0";
		      drive-strength = <30>;
	};

	lvds0_pins_b: lvds0@1 {
		      pins = "PD0", "PD1", "PD2", "PD3", "PD4", "PD5", "PD6", "PD7", "PD8", "PD9";
		      function = "gpio_in";
	};

	nand0_pins_default: nand0@0 {
		pins = "PC0", "PC1", "PC2", "PC5",
			 "PC8", "PC9", "PC10", "PC11",
			 "PC12", "PC13", "PC14", "PC15",
			 "PC16";
		function = "nand0";
		drive-strength = <30>;
	};

	nand0_pins_rb: nand0@1 {
		pins = "PC4", "PC6", "PC3", "PC7";
		function = "nand0";
		drive-strength = <30>;
		bias-pull-up;   /* only RB&CE should be pulled up */
	};

	nand0_pins_sleep: nand0@2 {
		pins = "PC0", "PC1", "PC2", "PC3",
			 "PC4", "PC5", "PC6", "PC7",
			 "PC8", "PC9", "PC10", "PC11",
			 "PC12", "PC13", "PC14", "PC15",
			 "PC16";
		function = "io_disabled";
		drive-strength = <10>;
	};


};

&soc {
	auto_print@54321 {
		reg = <0x0 0x54321 0x0 0x0>;
		device_type = "auto_print";
		status = "okay";
	};

	dsp0_rproc: dsp0_rproc@0 {
		mboxes = <&msgbox 4>;
		mbox-names = "arm-kick";
		memory-region = <&dsp0ddr_reserved>, <&dsp_vdev0buffer>, <&dsp_vdev0vring0>, <&dsp_vdev0vring1>,
				<&mcu0iram_reserved>, <&mcu0dram0_reserved>, <&mcu0dram1_reserved>;
		memory-mappings =
			/* < DA         len             PA >    */
			/* local SRAM via external bus */
			< 0x20000       0x20000         0x20000 >,
			/* local SRAM via internal bus */
			< 0x400000      0x10000         0x20000 >,
			< 0x420000      0x8000          0x30000 >,
			< 0x440000      0x8000          0x38000 >,
			/* DDR front 256MB */
			< 0x10000000    0x10000000      0x40000000 >,
			/* local SRAM via internal bus */
			< 0x20020000    0x10000         0x400000 >,
			< 0x20030000    0x8000          0x420000 >,
			< 0x20038000    0x8000          0x440000 >,

			/* DDR front 256MB */
			< 0x30000000    0x10000000      0x40000000 >,
			/* DDR front 1GB */
			< 0x40000000    0x40000000      0x40000000 >,
			/* DDR front 1GB */
			< 0x80000000    0x40000000      0x40000000 >,
			/* DDR front 1GB */
			< 0xC0000000    0x40000000      0x40000000 >;
		status = "okay";
	};

	e906_rproc: e906_rproc@7130000 {
		mboxes = <&msgbox 8>;
		mbox-names = "arm-kick";
		memory-region = <&riscvsram0_reserved>, <&riscvsram1_reserved>, <&rv_vdev0buffer>, <&rv_vdev0vring0>, <&rv_vdev0vring1>;
		memory-mappings =
			/* < DA		len		PA >	*/
			/* DSP RAM */
			< 0x20000	0x20000		0x20000 >,
			/* SRAM A2 */
			< 0x40000	0x24000		0x40000 >,
			/* DDR */
			< 0x8000000	0x37f00000	0x8000000 >,
			/* SRAM SPACE 0 */
			< 0x3ffc0000	0x40000		0x07280000 >,
			/* SRAM SPACE 1 */
			< 0x40000000	0x40000		0x072c0000 >,
			/* DRAM SPACE */
			< 0x40040000	0x3ffc0000	0x40040000>;
		status = "okay";
	};

};

&lradc {
	key_cnt = <5>;
	key0 = <210 0x73>;
	key1 = <410 0x72>;
	key2 = <590 0x8B>;
	key3 = <750 0x1c>;
	key4 = <880 0x66>;
	key_debounce;
	debounce_value = <50>;
	status = "disabled";
};


&gpadc0 {
	channel_num = <2>;
	channel_select = <3>;
	channel_data_select = <3>;
	channel_compare_select = <3>;
	channel_cld_select = <3>;
	channel_chd_select = <3>;
	channel0_compare_lowdata = <1700000>;
	channel0_compare_higdata = <1200000>;
	channel1_compare_lowdata = <460000>;
	channel1_compare_higdata = <1200000>;
	status = "disabled";
};

&gpadc1 {
	channel_num = <2>;
	channel_select = <3>;
	channel_data_select = <3>;
	channel_compare_select = <3>;
	channel_cld_select = <3>;
	channel_chd_select = <3>;
	channel0_compare_lowdata = <1700000>;
	channel0_compare_higdata = <1200000>;
	channel1_compare_lowdata = <460000>;
	channel1_compare_higdata = <1200000>;
	status = "disabled";
};

&ledc  {
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&ledc_pins_a>;
	pinctrl-1 = <&ledc_pins_b>;
	led_count = <4>;
	output_mode = "GRB";
	reset_ns = <84>;
	t1h_ns = <800>;
	t1l_ns = <320>;
	t0h_ns = <300>;
	t0l_ns = <800>;
	wait_time0_ns = <84>;
	wait_time1_ns = <84>;
	wait_data_time_ns = <600000>;
	status = "okay";
};


/{
	axp2202_parameter:axp2202-parameter {
		select = "battery-model";

		battery-model {
			parameter = /bits/ 8 <0x01 0xf5 0x40 0x00 0x1b 0x1e 0x28 0x0f
				0x0c 0x1e 0x32 0x02 0x14 0x05 0x0a 0x04
				0x74 0xfb 0xc8 0x0d 0x43 0x10 0x36 0xfb
				0x46 0x01 0xea 0x0d 0x2a 0x06 0x36 0x05
				0xf4 0x0a 0xb5 0x0f 0x42 0x0e 0xe6 0x09
				0x9a 0x0e 0x42 0x0e 0x3b 0x04 0x2d 0x04
				0x23 0x09 0x18 0x0e 0x09 0x0e 0x04 0x08
				0xf7 0x0d 0xda 0x0d 0xd0 0x03 0xbb 0x03
				0x9d 0x08 0x7f 0x0d 0x6a 0x0d 0x55 0x07
				0xc2 0x57 0x2b 0x27 0x1e 0x0d 0x14 0x08
				0xc5 0x98 0x7e 0x66 0x4e 0x44 0x38 0x1a
				0x12 0x0a 0xf6 0x00 0x00 0xf6 0x00 0xf6
				0x00 0xfb 0x00 0x00 0xfb 0x00 0x00 0xfb
				0x00 0x00 0xf6 0x00 0x00 0xf6 0x00 0xf6
				0x00 0xfb 0x00 0x00 0xfb 0x00 0x00 0xfb
				0x00 0x00 0xf6 0x00 0x00 0xf6 0x00 0xf6>;
		};
	};
};


&sdc2 {
	non-removable;
	bus-width = <8>;
	mmc-ddr-1_8v;
	mmc-hs200-1_8v;
	mmc-hs400-1_8v;
	no-sdio;
	no-sd;
	ctl-spec-caps = <0x308>;
	cap-mmc-highspeed;
	sunxi-power-save-mode;
	sunxi-dis-signal-vol-sw;
	mmc-bootpart-noacc;
	/*cap-hsq;*/
	cqe-on;
	ctl-cmdq-md = <0x2>;
	max-frequency = <150000000>;
	vmmc-supply = <&reg_cldo3>;
	/*emmc io vol 3.3v*/
	/*vqmmc-supply = <&reg_aldo1>;*/
	/*emmc io vol 1.8v*/
	vqmmc-supply = <&reg_cldo1>;
	status = "okay";
};

&sdc0 {
	bus-width = <4>;
	cd-gpios = <&pio PF 6 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
	/*non-removable;*/
	/*broken-cd;*/
	/*cd-inverted;*/
	/*data3-detect;*/
	/*card-pwr-gpios = <&pio PH 14 1 1 2 0xffffffff>;*/
	cd-set-debounce = <0x1>;
	cd-used-24M;
	cap-sd-highspeed;
	sd-uhs-sdr50;
	sd-uhs-ddr50;
	sd-uhs-sdr104;
	no-sdio;
	no-mmc;
	sunxi-power-save-mode;
	/*sunxi-dis-signal-vol-sw;*/
	max-frequency = <150000000>;
	ctl-spec-caps = <0x408>;
	sunxi-dly-208M  = <0xff 1 0xff 0xff 0xff 0xff>;
	/*vmmc-supply = <&reg_cldo3>;*/
	/*vqmmc33sw-supply = <&reg_cldo3>;*/
	/*vdmmc33sw-supply = <&reg_cldo3>;*/
	/*vqmmc18sw-supply = <&reg_bldo1>;*/
	/*vdmmc18sw-supply = <&reg_bldo1>;*/
	status = "okay";
};

&sdc1 {
	bus-width = <4>;
	no-mmc;
	no-sd;
	cap-sd-highspeed;
	/*sd-uhs-sdr12*/
	sd-uhs-sdr25;
	sd-uhs-sdr50;
	sd-uhs-ddr50;
	sd-uhs-sdr104;
	/*sunxi-power-save-mode;*/
	sunxi-dis-signal-vol-sw;
	cap-sdio-irq;
	keep-power-in-suspend;
	ignore-pm-notify;
	max-frequency = <150000000>;
	ctl-spec-caps = <0x408>;
	status = "okay";
};

&nand0 {
	compatible = "allwinner,sun55iw3-nand";
	device_type = "nand0";
	//reg = <0x0 0x04011000 0x0 0x1000>;/* nand0 */
	pinctrl-names = "default", "sleep";
	pinctrl-0 = <&nand0_pins_default &nand0_pins_rb>;
	pinctrl-1 = <&nand0_pins_sleep>;
	nand0_regulator1 = "vcc-nand";
	nand0_regulator2 = "none";
	nand0_cache_level = <0x55aaaa55>;
	nand0_flush_cache_num = <0x55aaaa55>;
	nand0_capacity_level = <0x55aaaa55>;
	nand0_id_number_ctl = <0x55aaaa55>;
	nand0_print_level = <0x55aaaa55>;
	nand0_p0 = <0x55aaaa55>;
	nand0_p1 = <0x55aaaa55>;
	nand0_p2 = <0x55aaaa55>;
	nand0_p3 = <0x55aaaa55>;
	chip_code = "sun55iw3";
	status = "disabled";
};

&rfkill {
	compatible = "allwinner,sunxi-rfkill";
	chip_en;
	power_en;
	pinctrl-0;
	pinctrl-names;
	status = "okay";

	/* wlan session */
	wlan {
		compatible    = "allwinner,sunxi-wlan";
		clocks        = <&rtc_ccu CLK_OSC32K_OUT>;
		clock-names   = "osc32k-out";
		wlan_power    = "axp2202-aldo3", "axp2202-bldo1"; /* vcc-pl/vcc-pg/vcc-pm */
		wlan_power_vol= <3300000>, <1800000>;
		wlan_busnum   = <0x1>;
		wlan_regon    = <&r_pio PM 1 GPIO_ACTIVE_HIGH>;
		wlan_hostwake = <&r_pio PM 0 GPIO_ACTIVE_HIGH>;
		wakeup-source;
	};

	/* bt session */
	bt {
		compatible    = "allwinner,sunxi-bt";
		clocks        = <&rtc_ccu CLK_OSC32K_OUT>;
		clock-names   = "osc32k-out";
		wlan_power    = "axp2202-aldo3", "axp2202-bldo1"; /* vcc-pl/vcc-pg/vcc-pm */
		wlan_power_vol= <3300000>, <1800000>;
		bt_rst_n      = <&r_pio PM 2 GPIO_ACTIVE_LOW>;
	};
};

&addr_mgt {
	compatible     = "allwinner,sunxi-addr_mgt";
	type_addr_wifi = <0x0>;
	type_addr_bt   = <0x0>;
	type_addr_eth  = <0x0>;
	status         = "okay";
};

&btlpm {
	compatible  = "allwinner,sunxi-btlpm";
	uart_index  = <0x1>;
	bt_wake     = <&r_pio PM 3 GPIO_ACTIVE_HIGH>;
	bt_hostwake = <&r_pio PM 4 GPIO_ACTIVE_HIGH>;
	wakeup-source;
	status      = "okay";
};

/*
 *usb_port_type: usb mode. 0-device, 1-host, 2-otg.
 *usb_detect_type: usb hotplug detect mode. 0-none, 1-vbus/id detect, 2-id/dpdm detect.
 *usb_detect_mode: 0-thread scan, 1-id gpio interrupt.
 *usb_id_gpio: gpio for id detect.
 *usb_det_vbus_gpio: gpio for id detect. gpio or "axp_ctrl";
 *usb_wakeup_suspend：0-SUPER_STANDBY, 1-USB_STANDBY.
 */
&usbc0 {
	device_type = "usbc0";
	usb_port_type = <0x2>;
	usb_detect_type = <0x1>;
	usb_detect_mode = <0x0>;
	usb_id_gpio = <>;
	// usb_det_vbus_gpio = <&pio PI 13 GPIO_ACTIVE_HIGH>;
	enable-active-high;
	detvbus_io-supply = <&reg_bldo1>;
	usb_regulator_io = "nocare";
	usb_wakeup_suspend = <0>;
	usb_luns = <3>;
	usb_serial_unique = <0>;
	usb_serial_number = "20080411";
	rndis_wceis = <1>;
	status = "okay";
};

&udc {
	det_vbus_supply = <&usb_power_supply>;
	phy_range = <0x153>;
	status = "okay";
};

&ehci0 {
	drvvbus-supply = <&reg_usb0_vbus>;
	phy_range = <0x153>;
	status = "okay";
};

&ohci0 {
	drvvbus-supply = <&reg_usb0_vbus>;
	phy_range = <0x153>;
	status = "okay";
};

&usbc1 {
	device_type = "usbc1";
	usb_regulator_io = "nocare";
	usb_wakeup_suspend = <0>;
	status = "okay";
};

&ehci1 {
	phy_range = <0x153>;
	status = "okay";
};

&ohci1 {
	phy_range = <0x153>;
	status = "okay";
};

&usbc2 {
	device_type = "usbc2";
	status = "okay";
};
&xhci2 {
	dr_mode = "host";
	status = "okay";
};
&u2phy {
	status = "okay";
};

&combophy {
	resets = <&ccu RST_BUS_PCIE_USB3>;
	phy_use_sel = <1>; /* 0:PCIE; 1:USB3 */
	status = "okay";
};
&pcie {
	pcie3v3-supply = <&reg_bldo1>;
	pcie1v8-supply = <&reg_cldo1>;
};


/{
	leds: leds@0 {
		compatible = "gpio-leds";
		status = "okay";
		power-led {
			function = LED_FUNCTION_STATUS;
			color = <LED_COLOR_ID_GREEN>;
			gpios = <&pio PB 8 GPIO_ACTIVE_HIGH>; 
			default-state = "on";
		};
	};
};

&gpu {
	gpu_idle = <1>;
	dvfs_status = <1>;
	mali-supply = <&reg_dcdc2>;
};

&ve {
	ve-supply = <&reg_dcdc2>;

	enable_setup_ve_freq       = <0>;   /* default disable */
	ve_freq_value              = <624>; /* setup to 624MHz */
};

&cpu0 {
	cpu-supply = <&reg_dcdc1>;
};

&dsufreq {
	dsu-supply = <&reg_dcdc1>;
};


&npu {
	npu-supply = <&reg_ext_axp1530_dcdc3>;
	status = "okay";
};

&cpul_thermal_zone {
	cpul_trips: trips {
		cpul_crit: cpu_crit@0 {
			temperature = <115000>;
			type = "critical";
			hysteresis = <0>;
		};
	};
};

&cpub_thermal_zone {
	cpub_trips: trips {
		cpub_crit: cpu_crit@0 {
			temperature = <115000>;
			type = "critical";
			hysteresis = <0>;
		};
	};
};

&gpu_thermal_zone {
	gpu_trips: trips {
		gpu_crit: gpu_crit@0 {
			temperature = <115000>;
			type = "critical";
			hysteresis = <0>;
		};
	};
};

&pd1 {
	/* pk */
	pd1_vi@A523_PCK_VI {
		ppu-always-on;
	};

	/* pd */
	pd1_vo0@A523_PCK_VO0 {
		ppu-always-on;
	};

	/* pj */
	pd1_vo1@A523_PCK_VO1 {
		ppu-always-on;
	};
};
